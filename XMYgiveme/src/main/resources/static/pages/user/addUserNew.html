<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>飞凡CRM管理系统</title>
<link href="/assets/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet"
	type="text/css" />
<link href="/assets/stylesheets/main.css" rel="stylesheet"
	type="text/css" />
<link href="/assets/stylesheets/idea.css" rel="stylesheet"
	type="text/css" />
<script type="text/javascript" src="/assets/scripts/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="/assets/scripts/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/scripts/jquery.cookie.js"></script>
<script type="text/javascript" src="/sysResource"></script>

<script type="text/javascript" src="/resources/js/user/addUserNew.js"></script>
<script type="text/javascript" src="/assets/scripts/MD5.js"></script>
</head>

<body>

	<div class="net_container" id="containerdiv">
		<!--顶部logo start-->
		<div class="net_header">
			<img src="/assets/images/crm-logo.png" />
		</div>
		<!--顶部logo end-->
		<!--顶部menu start-->
		<!--<div class="menu">This is the Menu</div>-->
		<!--顶部menu end-->
		<!--内容部分 start-->
		<div class="net_mainContent">
			<!--左侧导航 start-->
			<div class="net_sidebar">
				<div class="sidebar_adm">
					<div class="sidebar_t">
						<img src="/assets/images/318751.jpg" />
					</div>
					<div class="sidebar_m">
						<span>Vamgana</span>
					</div>
				</div>
				<div class="sidebar_b">
					<div class="sidebar_btn">
						<img src="/assets/images/data-icon.png" />数据中心
					</div>
					<div class="sidebar_btn_on">
						<img src="/assets/images/originality-icon-c.png" width="17" />创意
					</div>
					<div class="sidebar_btn">
						<img src="/assets/images/cast-icon.png" />投放
					</div>
					<div class="sidebar_btn">
						<img src="/assets/images/money-icon.png" />财务
					</div>
					<div class="sidebar_btn">
						<img src="/assets/images/off-icon.png" /><a
							href="/account/logout">退出</a>
					</div>
				</div>
			</div>
			<!--左侧导航 end-->
			<!--主要内容 start-->
			<div class="content_bg">
				<div class="net_content">
					<div class="content_t">
						<div class="content_t_l"></div>
						<div class="content_t_r">新建用户</div>
					</div>
				</div>
				<div class="content_m">
					<div class="content_m_info" style="float: none">
						<div class="module">
							<div class="module_l">用户类型</div>
							<div class="module_c">
									<select name="userType" id="userType">
									</select> <select name="userRoles" id="userRoles">
									</select>
							</div>
							<span id="userTypeSpan" class="text-danger"></span> <span id="userRolesSpan"
								class="text-danger"></span>
							<div class="clearfloat"></div>
						</div>
						<div class="module" id="crmemail">
							<div class="module_l">
								<span id="wandaEmailLabel">万达邮箱</span> <span id="emailLabel" class="hidden">邮箱</span>
							</div>
							<div class="module_c">
								<input class="input_3" type="text" maxlength="30"
									id="accountEmail" name="accountEmail" /><span
									id="accountEmailSpan" class="text-danger"></span>
							</div>
							<div class="clearfloat"></div>
						</div>
						<div class="module" id="pass">
							<div class="module_l">密码</div>
							<div class="module_c">
								<input class="input_3" type="password" maxlength="16"
									name="password" id="password" /><span id="passwordSpan"
									class="text-danger"></span>
							</div>
							<div class="clearfloat"></div>
						</div>
						<div class="module" id="cpass">
							<div class="module_l">确认密码</div>
							<div class="module_c">
								<input class="input_3" type="password" maxlength="16"
									id="confirmPassword" /><span id="confirmPasswordSpan"
									class="text-danger"></span>
							</div>
							<div class="clearfloat"></div>
						</div>
						<div class="module hidden" id="profitShareDiv" >
							<div class="module_l">分成</div>
							<div class="module_c">
								<input class="input_3" maxlength="5" type="number"
									id="profitShare" name="profitShare" min="0.01" max="100" />%<span
									id="profitShareSpan" class="text-danger"></span>
							</div>
							<div class="clearfloat"></div>
						</div>
						<div class="module hidden" id="companyDiv" >
							<div class="module_l">公司名称</div>
							<div class="module_c">
								<input class="input_3" maxlength="18" type="text" name="company"
									id="company" />非必填
							</div>
							<div class="clearfloat"></div>
						</div>
						<div class="module">
							<div class="module_c module_pos" id="btcrm">
								<button class="button_2" id="createAccount">开通</button>
							</div>
							<div class="clearfloat"></div>
						</div>
					</div>

				</div>
				<!--主要内容 end-->
				<div class="clearfloat"></div>
			</div>
		</div>
		<!--内容部分 end-->
		<!--底部 start-->
		<!--<div class="footer"></div>-->
		<!--底部 end-->

		<script type="text/javascript">
	

			function openaccount() {
				var usertype = $("#usertype").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var role = $("#role").val().replace(/(^\s*)|(\s*$)/g, "");
				var crmemail = $("#crmemailtxt").val().replace(
						/(^\s*)|(\s*$)/g, "");
				var sdemail = $("#sdemailtxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var pass = $("#passtxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var cpass = $("#cpasstxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var company = $("#companytxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var regpass = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{8,16}$/;

				if (usertype == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#usertype").focus();
					return;
				}
				if (role == 0) {
					$("#userrr").html("请选择用户类型或用户角色");
					$("#role").focus();
					return;
				}

				if (crmemail == '') {
					$("#usertt").html("");
					$("#ccrmemail").html("邮箱不能为空");
					$("#crmemailtxt").select();
					return;
				}
				if (crmemail != '') {
					var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
					if (!reg.test(crmemail)) {
						$("#ccrmemail").html("邮箱格式不正确");
						$("#crmemailtxt").select();
						return;
					} else if (!(/^[\w._]+@(wanda)\.cn(\r\n|\r|\n)?$/)
							.test(crmemail)) {
						$("#ccrmemail").html("请使用万达邮箱");
						$("#crmemailtxt").select();
						return;
					} else {
						$
								.ajax({
									url : "/account/email",
									method : 'post',
									contentType : 'application/json',
									data : JSON.stringify({
										accountEmail : crmemail
									}),
									success : function(result) {
										if (result == 1) {
											$("#ccrmemail").html("此邮箱已存在");
											$("#crmemailtxt").focus();
											return;
										} else {
											$("#ccrmemail").html("");
											if (pass == "") {
												$("#ppass").html("密码不能为空");
												$("#passtxt").select();
												return;
											}
											if (pass.length<8 || pass.length>16) {
												$("#ppass").html("");
												$("#ppass").html(
														"密码需不少于8位的数字字母或符号");
												$("#passtxt").select();
												return;
											}
											if (cpass != pass) {
												$("#ppass").html("");
												$("#ccpass").html(
														"确认密码与密码输入不一致");
												$("#cpasstxt").select();
												return;
											} else {
												$
														.ajax({
															url : "/account/addcrmemail",
															method : 'post',
															contentType : 'application/json',
															data : JSON
																	.stringify({
																		userType : usertype,
																		userRoles : role,
																		accountEmail : crmemail,
																		password : hex_md5(pass),
																		adminId : parseInt(acouid)
																	}),
															success : function(
																	result) {
																if (result > 0) {
																	alert("添加成功！");
																	//$("#containerdiv").hide();
																	cancel();
																	return;
																} else {
																	alert("您的帐户已被冻结！");
																	window.location.href = "backcrmlogin.html";
																}
															}
														});
											}
										}
									}
								});
					}
				}

			}
			function openaccountlm() {
				var usertype = $("#usertype").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var role = $("#role").val().replace(/(^\s*)|(\s*$)/g, "");
				var sdemail = $("#sdemailtxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var pass = $("#passtxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var cpass = $("#cpasstxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var pshare = $("#psharetxt").val()
						.replace(/(^\s*)|(\s*$)/g, "");
				var company = $("#companytxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var regpass = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{8,16}$/;
				var proshare = parseFloat(0);

				if (usertype == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#usertype").focus();
					return;
				}
				if (role == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#role").focus();
					return;
				}
				if (sdemail == '') {
					$("#usertt").html("");
					$("#ssdemail").html("邮箱不能为空！");
					$("#sdemailtxt").select();
					return;
				}

				if (sdemail != '') {
					//document.getElementById("ccrmemail").style.dispaly = "none";
					var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
					if (!reg.test(sdemail)) {
						$("#ssdemail").html("邮箱格式不正确");
						$("#sdemailtxt").select();
						return;
					} else {
						$
								.ajax({
									url : "/account/dsemail",
									method : 'post',
									contentType : 'application/json',
									data : JSON.stringify({
										accountEmail : sdemail,
										userType : usertype
									}),
									success : function(result) {
										if (result == 1) {
											$("#ssdemail").html("此邮箱已存在");
											$("#sdemailtxt").select();
											return;
										} else {
											$("#ssdemail").html("");
											if (pass == "") {
												$("#ppass").html("密码不能为空");
												$("#passtxt").select();
												return;
											}
											if (pass.length<8 || pass.length>16) {
												$("#ppass").html("");
												$("#ppass").html(
														"密码需不少于8位的数字字母或符号");
												$("#passtxt").select();
												return;
											}
											if (cpass != pass) {
												$("#ppass").html("");
												$("#ccpass").html(
														"确认密码与密码输入不一致");
												$("#cpasstxt").select();
												return;
											}
											$("#ccpass").html("");
											if (pshare == "") {
												$("#ppshare").html("分成不能为空");
												$("#psharetxt").select();
												return;
											}
											if (parseFloat(pshare) < 1
													|| parseFloat(pshare) > 100) {
												$("#ppshare").html(
														"分成大于0或分成小于100");
												$("#psharetxt").select();
												return;
											}
											var reNum = /^\d+(\.\d+)?$/;
											if (!reNum.test(pshare)) {
												$("#ppshare").html("分成必须为数字");
												$("#psharetxt").select();
												return;
											} else {
												proshare = parseFloat(pshare) / 100;
												//var num = proshare.toFixed(2);//四舍五入
												var num = Math
														.floor(proshare * 100) / 100; //不四舍五入
												$("#ccpass").html("");
												$("#ppsharetxt").html("");
												$
														.ajax({
															url : "/account/addcrmemail",
															method : 'post',
															contentType : 'application/json',
															data : JSON
																	.stringify({
																		userType : usertype,
																		userRoles : role,
																		accountEmail : sdemail,
																		password : hex_md5(pass),
																		profitShare : proshare,//proshare,
																		company : company,
																		adminId : parseInt(acouid)
																	}),
															success : function(
																	result) {
																if (result > 0) {
																	alert("添加成功！");
																	//window.location.href = "crmuserlist.html";
																	//$("#containerdiv").hide();
																	cancel();
																	return;
																} else {
																	alert("您的帐户已被冻结！");
																	window.location.href = "backcrmlogin.html";
																}
															}
														});
											}
										}
									}
								});

					}
				}
			}

			function openaccountdsp() {
				var usertype = $("#usertype").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var role = $("#role").val().replace(/(^\s*)|(\s*$)/g, "");
				var sdemail = $("#sdemailtxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var pass = $("#passtxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var cpass = $("#cpasstxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var company = $("#companytxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var regpass = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{8,16}$/;

				if (usertype == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#usertype").focus();
					return;
				}
				if (role == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#role").focus();
					return;
				}
				if (sdemail == '') {
					$("#usertt").html("");
					$("#ssdemail").html("邮箱不能为空！");
					$("#sdemailtxt").select();
					return;
				}
				if (crmemail != '') {
					var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
					if (!reg.test(sdemail)) {
						$("#ssdemail").html("邮箱格式不正确");
						$("#sdemailtxt").select();
						return;
					} else {
						$
								.ajax({
									url : "/account/dsemail",
									method : 'post',
									contentType : 'application/json',
									data : JSON.stringify({
										accountEmail : sdemail,
										userType : usertype
									}),
									success : function(result) {
										if (result == 1) {
											$("#ssdemail").html("此邮箱已存在");
											$("#sdemailtxt").select();
											return;
										} else {
											$("#ssdemail").html("");
											if (pass == "") {
												$("#ppass").html("密码不能为空");
												$("#passtxt").select();
												return;
											}
											if (pass.length<8 || pass.length>16) {
												$("#ppass").html("");
												$("#ppass").html(
														"密码需不少于8位的数字字母或符号");
												$("#passtxt").select();
												return;
											}
											if (cpass != pass) {
												$("#ppass").html("");
												$("#ccpass").html(
														"确认密码与密码输入不一致");
												$("#cpasstxt").select();
												return;
											} else {
												$("#ccpass").html("");
												$
														.ajax({
															url : "/account/addcrmemail",
															method : 'post',
															contentType : 'application/json',
															data : JSON
																	.stringify({
																		userType : usertype,
																		userRoles : role,
																		accountEmail : sdemail,
																		password : hex_md5(pass),
																		company : company,
																		adminId : parseInt(acouid)
																	}),
															success : function(
																	result) {
																if (result > 0) {
																	alert("添加成功！");
																	//window.location.href = "crmuserlist.html";
																	//$("#containerdiv").hide();
																	cancel();
																	return;
																} else {
																	alert("您的帐户已被冻结！");
																	window.location.href = "backcrmlogin.html";
																}
															}
														});
											}

										}
									}
								});
					}
				}
			}

			function openaccountsspgj() {
				var usertype = $("#usertype").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var role = $("#role").val().replace(/(^\s*)|(\s*$)/g, "");
				var crmemail = $("#crmemailtxt").val().replace(
						/(^\s*)|(\s*$)/g, "");
				var pass = $("#passtxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var cpass = $("#cpasstxt").val().replace(/(^\s*)|(\s*$)/g, "");
				var company = $("#companytxt").val().replace(/(^\s*)|(\s*$)/g,
						"");
				var regpass = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{8,16}$/;

				if (usertype == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#usertype").focus();
					return;
				}
				if (role == 0) {
					$("#usertt").html("请选择用户类型或用户角色");
					$("#role").focus();
					return;
				}
				if (crmemail == '') {
					$("#usertt").html("");
					$("#ccrmemail").html("邮箱不能为空！");
					$("#crmemailtxt").select();
					return;
				}
				if (crmemail != '') {
					var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
					if (!reg.test(crmemail)) {
						$("#ccrmemail").html("邮箱格式不正确");
						$("#crmemailtxt").focus();
						return;
					} else if (!(/^[\w._]+@(wanda)\.cn(\r\n|\r|\n)?$/)
							.test(crmemail)) {
						$("#ccrmemail").html("请使用万达邮箱");
						$("#crmemailtxt").focus();
						return;
					} else {
						$
								.ajax({
									url : "/account/dsemail",
									method : 'post',
									contentType : 'application/json',
									data : JSON.stringify({
										accountEmail : crmemail,
										userType : usertype
									}),
									success : function(result) {
										if (result == 1) {
											$("#ccrmemail").html("此邮箱已存在");
											$("#crmemailtxt").select();
											return;
										} else {

											$("#ccrmemail").html("");
											if (pass == "") {
												$("#ppass").html("密码不能为空");
												$("#passtxt").select();
												return;
											}
											if (pass.length<8 || pass.length>16) {
												$("#ppass").html("");
												$("#ppass").html(
														"密码需不少于8位的数字字母或符号");
												$("#passtxt").select();
												return;
											}
											if (!regpass.test(pass)) {
												$("#ppass").html("");
												$("#ppass").html(
														"密码需不少于8位的数字字母或符号");
												$("#passtxt").select();
												return;
											}
											if (cpass != pass) {
												$("#ppass").html("");
												$("#ccpass").html(
														"确认密码与密码输入不一致");
												$("#cpasstxt").select();
												return;
											} else {
												$("#ccpass").html("");
												$
														.ajax({
															url : "/account/addcrmemail",
															method : 'post',
															contentType : 'application/json',
															data : JSON
																	.stringify({
																		userType : usertype,
																		userRoles : role,
																		accountEmail : crmemail,
																		password : hex_md5(pass),
																		company : company,
																		adminId : parseInt(acouid)
																	}),
															success : function(
																	result) {
																if (result > 0) {
																	alert("添加成功！");
																	//window.location.href = "crmuserlist.html";
																	cancel();
																	return;
																} else {
																	alert("您的帐户已被冻结！");
																	window.location.href = "backcrmlogin.html";
																}
															}
														});
											}

										}
									}
								});
					}
				}
			}

			function cancel() {
				//document.getElementById("usertype").value = "0";
				//document.getElementById("role").value = "0";
				document.getElementById("crmemailtxt").value = "";
				document.getElementById("passtxt").value = "";
				document.getElementById("cpasstxt").value = "";
				document.getElementById("sdemailtxt").value = "";
				document.getElementById("psharetxt").value = "";
				$("#companytxt").val("");
				$("#usertt").html("");
				$("#userrr").html("");
				$("#ccrmemail").html("");
				$("#ssdemail").html("");
				$("#ppass").html("");
				$("#ccpass").html("");
				$("#ppshare").html("");

				//document.getElementById("containerdiv").style.display="none";
				//$("#containerdiv").hide();
			}
			/*function showcontain(){
			$.ajax({
				url : "/account/admin",
				method : 'post',
				contentType : 'application/json',
				data : JSON.stringify({
					adminId: parseInt(acouid)
				}),
				dataType: 'json', 
				success : function(result) {
					if(result>0){
						
						
						
					}else{
						return;
					}
				}
			});
			
			}*/
		</script>
	</div>
</body>
</html>
