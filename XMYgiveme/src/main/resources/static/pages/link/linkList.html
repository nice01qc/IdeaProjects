<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>创意链接类型</title>
    <link rel="stylesheet" type="text/css" href="/assets/scripts/bootstrap/css/bootstrap.min.css" />
    <link href="/assets/stylesheets/main.css" rel="stylesheet" type="text/css" />
    <link href="/assets/stylesheets/log.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/assets/scripts/mtree/css/mtree.css">
    <link href="/resources/css/pagination.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="/assets/scripts/jquery-2.2.3.min.js"></script>
    <script src='/assets/scripts/mtree/js/jquery.velocity.min.js'></script>
	<script type="text/javascript" src="/resources/js/web-common.js"></script>
</head>
<body>
<div class="net_container">
    <!--顶部logo start-->
    <div class="net_header"><img src="/assets/images/crm-logo.png" /></div>
    <!--顶部logo end-->
    <!--顶部menu start-->
    <!--<div class="menu">This is the Menu</div>-->
    <!--顶部menu end-->
    <!--内容部分 start-->
    <div class="net_mainContent">
       <!--左侧导航 start-->
		<div class="net_sidebar">
			<ul class="mtree transit" id="mtree">
			</ul>
		</div>
        <!--左侧导航 end-->
        <!--主要内容 start-->
        <div class="content_bg">
                <form id="query">
	                <div class="account-info" >
	                    <div class="account-info-border" style="margin-left:-2px;"></div>
	                    <div class="account-info-font" >创意链接类型</div>
	                </div>
	                <div class="title" >
	                    <div class="list">
	                        <select name="belongsTo" id="belongsTo" style="margin-left:10px;">
						        <option value="0">飞凡</option>
						    </select>
	                    </div>
	                    <div class="list">
	                        <select name="clientType" id="clientType">
						        <option value="1">App</option>
						        <option value="2">飞凡M站</option>
						    </select>
	                    </div>
	                    <div class="list" style="margin-right:18px;">
	                        <select name="supportApps" id="supportApps" >
						        <option value="1" class="supportAppsApp">飞凡ios</option>
						        <option value="2" class="supportAppsApp">飞凡Android</option>
						        <option value="4" style="display:none" class="supportAppsH5">飞凡</option>
						        <option value="8" style="display:none" class="supportAppsH5">飞悦</option>
						    </select>
	                    </div>
	                    <button type="button" id="queryButton" style="color:#ffffff;height:30px;margin-top:6px; font-weight:bold;font-size:15px;" >查询</button>
	                </div>
                </form>
                <table class="table_comment" border="1"  cellspacing="0"  style="margin-left:26px; width: 990px;">
                	<thead>
	                    <tr class="tr-a" >
	                        <td class="td-a">创意链接类型ID</td>
	                        <td class="td_comment">创意链接类型名称</td>
	                        <td class="td_comment">使用描述</td>
	                        <td class="td-a">资源归属</td>
	                        <td class="td-a">客户端类型</td>
	                        <td class="td-a">支持应用</td>
	                    </tr>
                    </thead>
                    <tbody id="listTableBody"></tbody>
                </table>
                <div id="Pagination" class="pagination" >
                    <div class="pre-page"><i class="glyphicon glyphicon-triangle-left"></i></div>
                    <div class="page-info" >0  /  0</div>
                    <div class="next-page"><i class="glyphicon glyphicon-triangle-right"></i></div>
                    <div id='pageNumDiv'>
                        <input type='text' placeholder="页码" class='text-box' id='current_page' value=''/>
                        <button class='button-next' id='pageNumClick'>跳转</button>
                    </div>
                </div>
            </div> 
            <!--主要内容 end-->
            <div class="clearfloat"></div>
        </div>
    </div>
    <!--内容部分 end-->
    <!--底部 start-->
    <!--<div class="footer"></div>-->
    <!--底部 end-->
<script>
var items_per_page = 20; 
var current_page = 1;
var pageTotal = 0;

$(document).ready(function () {
	getDataList();
	
    $('#clientType').change(function () {
        var clientType = $(this).children('option:selected').val()
        if (clientType == 1) {
            $('.supportAppsApp').show();
            $('.supportAppsH5').hide();
            $('.supportAppsApp')[0].selected = 'selected';
        } else {
            $('.supportAppsApp').hide();
            $('.supportAppsH5').show();
            $('.supportAppsH5')[0].selected = 'selected';
        }
    });
    
    function writeTable(data) {
        var html = "";
        $.each(data.rows,function(i,n){
        	 if (data.rows[i].belongsTo == 0)data.rows[i].belongsTo = "飞凡";
        	 data.rows[i].clientType = convertClientType(data.rows[i].clientType);
        	 data.rows[i].supportApps = convertSupportApps(data.rows[i].supportApps);
        	 if (data.rows[i].comment == null)data.rows[i].comment = "";
         	if(i%2 == 0){
        		html +='<tr class="tr-b">';
        	}else{
        		html +='<tr class="tr-a">';
        	}
             html += "<td class='td-a'>" + data.rows[i].id + 
             "</td><td class='td_comment' title='"+ data.rows[i].name+"'>" + data.rows[i].name + 
             "</td>&nbsp;&nbsp;&nbsp;<td class='td_comment' title='"+data.rows[i].comment+"'>" + data.rows[i].comment + 
             "</td><td class='td-a'>" + data.rows[i].belongsTo + 
             "</td><td class='td-a'>" + data.rows[i].clientType + 
             "</td><td class='td-a'>" + data.rows[i].supportApps + "</td></tr>"
        }); 
        if(html == ''){
        	html ='<tr class="tr-b" ><td  class="td-a" colspan =6>没有找到匹配的记录</td></tr>'
        	$("#Pagination").hide();		
        }else{
        	$("#Pagination").show();	
        }
         $('#listTableBody').html(html);
         if(data.total == 0){
         	$('.page-info').text('0 / 0');
         }else{
         	pageTotal = Math.ceil(data.total/items_per_page);
             $('.page-info').text(current_page + ' / ' + pageTotal);
         }
        $("#current_page").val('');
     }
    
    function convertClientType(clientType) {
        var temp = "";
        if ((clientType & 1) > 0) temp += "/App"
        if ((clientType & 2) > 0) temp += "/飞凡M站"
        return temp.replace(/\//, '');
    }
    function convertSupportApps(supportApps) {
        var temp = "";
        if ((supportApps & 1) > 0) temp += "/飞凡ios"
        if ((supportApps & 2) > 0) temp += "/飞凡Android"
        if ((supportApps & 4) > 0) temp += "/飞凡"
        if ((supportApps & 8) > 0) temp += "/飞悦"
        return temp.replace(/\//, '');
    }
    
    function getDataList(){
        $.ajax({  
            type: "get",  
            url: "/link/list",
            data: {'belongsTo':$('#belongsTo').val(),'clientType':$('#clientType').val(),'supportApps':$('#supportApps').val(),'pageNo':current_page,'pageSize':items_per_page},  
            dataType: 'json',  
            contentType: "application/x-www-form-urlencoded",  
            success: function (result) {
            	writeTable(result);
            	updatePageBtnStatus();
            }
        });
    }
  	//跳转
	$("#pageNumClick").click(function(){
		var goToPageNumStr = $("#current_page").val();
		$("#current_page").val("");
		if( goToPageNumStr != '' && !isNaN(goToPageNumStr)) {
			var goToPageNum = parseInt(goToPageNumStr);
			if(goToPageNum <= 0) {
				goToPageNum = 1;
			} else if(goToPageNum > pageTotal) {
				goToPageNum = pageTotal;
			}
			//判断是否跳转到当前页
			if(goToPageNum == current_page) {
				return false;
			} else {
				current_page = goToPageNum;
				scrollToTableHead();
				getDataList();
			}
    	}	
	});
	//下一页
	$(".next-page").click(function(){
		if(current_page + 1 <= pageTotal){
			current_page = current_page + 1;
			scrollToTableHead();
			getDataList(); 
		}
	});
	//上一页
	$(".pre-page").click(function(){
		if(current_page - 1 > 0){
			current_page = current_page - 1;
			scrollToTableHead();
			getDataList(); 
		}	
	});
	//查询
	$("button#queryButton").click(function(){
		current_page = 1;
		getDataList(); 
	});
	
	/**
	 * 更新翻页按钮状态
	 * @returns
	 */
	function updatePageBtnStatus() {
		$(".pagination .next-page").removeClass("unused");
		$(".pagination .pre-page").removeClass("unused");
		if(current_page == pageTotal) {
			$(".pagination .next-page").addClass("unused");
		}
		if(current_page == 1) {
			$(".pagination .pre-page").addClass("unused");
		}
	}
});
</script>
</body>
</html>
